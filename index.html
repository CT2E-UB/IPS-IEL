<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css"><link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/filter.css">
<link rel="stylesheet" href="css/nouislider.min.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title>IPS, indice d'éloignement à l'ESR et dispositifs égalité des chances des lycées</title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="js/tailDT.js"></script>
<script src="js/nouislider.min.js"></script>
<script src="js/wNumb.js"></script>
        <script src="data/Dpartement_1.js"></script>
        <script src="data/Rgion_2.js"></script>
        <script src="data/Prefecture_3.js"></script>
        <script src="data/IndicedepositionsocialeIndedloignementdeslyces_4.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
            highlightLayer.openPopup();
        }
        var map = L.map('map', {
            zoomControl:true, maxZoom:28, minZoom:7
        }).fitBounds([[42.36573164056156,-4.397881881250022],[47.76338391349526,5.792047678219274]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        document.querySelector(".leaflet-popup-pane").addEventListener("load", function(event) {
          var tagName = event.target.tagName,
            popup = map._popup;
          // Also check if flag is already set.
          if (tagName === "IMG" && popup && !popup._updated) {
            popup._updated = true; // Set flag to prevent looping.
            popup.update();
          }
        }, true);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OSMStandard_0');
        map.getPane('pane_OSMStandard_0').style.zIndex = 400;
        var layer_OSMStandard_0 = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OSMStandard_0',
            opacity: 0.8,
            attribution: '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
            minZoom: 7,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OSMStandard_0;
        map.addLayer(layer_OSMStandard_0);
        function pop_Dpartement_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ID_GEOFLA'] !== null ? autolinker.link(feature.properties['ID_GEOFLA'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODE_DEPT'] !== null ? autolinker.link(feature.properties['CODE_DEPT'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NOM_DEPT'] !== null ? autolinker.link(feature.properties['NOM_DEPT'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODE_CHF'] !== null ? autolinker.link(feature.properties['CODE_CHF'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NOM_CHF'] !== null ? autolinker.link(feature.properties['NOM_CHF'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['X_CHF_LIEU'] !== null ? autolinker.link(feature.properties['X_CHF_LIEU'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Y_CHF_LIEU'] !== null ? autolinker.link(feature.properties['Y_CHF_LIEU'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['X_CENTROID'] !== null ? autolinker.link(feature.properties['X_CENTROID'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Y_CENTROID'] !== null ? autolinker.link(feature.properties['Y_CENTROID'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODE_REG'] !== null ? autolinker.link(feature.properties['CODE_REG'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NOM_REG'] !== null ? autolinker.link(feature.properties['NOM_REG'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['B_Effectif'] !== null ? autolinker.link(feature.properties['B_Effectif'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['B_Tx_DEPBA'] !== null ? autolinker.link(feature.properties['B_Tx_DEPBA'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['B_Tx_DEP_1'] !== null ? autolinker.link(feature.properties['B_Tx_DEP_1'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['R_EFFECIF_'] !== null ? autolinker.link(feature.properties['R_EFFECIF_'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['R_Tx_DepRe'] !== null ? autolinker.link(feature.properties['R_Tx_DepRe'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['R_Tx_Dep_1'] !== null ? autolinker.link(feature.properties['R_Tx_Dep_1'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['IPS_mean'] !== null ? autolinker.link(feature.properties['IPS_mean'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
            var popup = layer.getPopup();
            var content = popup.getContent();
            var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
            popup.setContent(updatedContent);
        }

        function style_Dpartement_1_0() {
            return {
                pane: 'pane_Dpartement_1',
                opacity: 1,
                color: 'rgba(82,82,82,1.0)',
                dashArray: '5.0,1.0',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(204,204,204,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Dpartement_1');
        map.getPane('pane_Dpartement_1').style.zIndex = 401;
        map.getPane('pane_Dpartement_1').style['mix-blend-mode'] = 'normal';
        var layer_Dpartement_1 = new L.geoJson(json_Dpartement_1, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Dpartement_1',
            layerName: 'layer_Dpartement_1',
            pane: 'pane_Dpartement_1',
            onEachFeature: pop_Dpartement_1,
            style: style_Dpartement_1_0,
        });
        bounds_group.addLayer(layer_Dpartement_1);
        map.addLayer(layer_Dpartement_1);
        function pop_Rgion_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ID_GEOFLA'] !== null ? autolinker.link(feature.properties['ID_GEOFLA'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODE_DEPT'] !== null ? autolinker.link(feature.properties['CODE_DEPT'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">NOM_DEPT</th>\
                        <td>' + (feature.properties['NOM_DEPT'] !== null ? autolinker.link(feature.properties['NOM_DEPT'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODE_CHF'] !== null ? autolinker.link(feature.properties['CODE_CHF'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NOM_CHF'] !== null ? autolinker.link(feature.properties['NOM_CHF'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['X_CHF_LIEU'] !== null ? autolinker.link(feature.properties['X_CHF_LIEU'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Y_CHF_LIEU'] !== null ? autolinker.link(feature.properties['Y_CHF_LIEU'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['X_CENTROID'] !== null ? autolinker.link(feature.properties['X_CENTROID'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Y_CENTROID'] !== null ? autolinker.link(feature.properties['Y_CENTROID'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODE_REG'] !== null ? autolinker.link(feature.properties['CODE_REG'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NOM_REG'] !== null ? autolinker.link(feature.properties['NOM_REG'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['B_Effectif'] !== null ? autolinker.link(feature.properties['B_Effectif'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['B_Tx_DEPBA'] !== null ? autolinker.link(feature.properties['B_Tx_DEPBA'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['B_Tx_DEP_1'] !== null ? autolinker.link(feature.properties['B_Tx_DEP_1'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['R_EFFECIF_'] !== null ? autolinker.link(feature.properties['R_EFFECIF_'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['R_Tx_DepRe'] !== null ? autolinker.link(feature.properties['R_Tx_DepRe'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['R_Tx_Dep_1'] !== null ? autolinker.link(feature.properties['R_Tx_Dep_1'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['IPS_mean'] !== null ? autolinker.link(feature.properties['IPS_mean'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
            var popup = layer.getPopup();
            var content = popup.getContent();
            var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
            popup.setContent(updatedContent);
        }

        function style_Rgion_2_0() {
            return {
                pane: 'pane_Rgion_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(213,180,60,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Rgion_2');
        map.getPane('pane_Rgion_2').style.zIndex = 402;
        map.getPane('pane_Rgion_2').style['mix-blend-mode'] = 'normal';
        var layer_Rgion_2 = new L.geoJson(json_Rgion_2, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Rgion_2',
            layerName: 'layer_Rgion_2',
            pane: 'pane_Rgion_2',
            onEachFeature: pop_Rgion_2,
            style: style_Rgion_2_0,
        });
        bounds_group.addLayer(layer_Rgion_2);
        map.addLayer(layer_Rgion_2);
        function pop_Prefecture_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['insee'] !== null ? autolinker.link(feature.properties['insee'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['nom'] !== null ? autolinker.link(feature.properties['nom'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">wikipedia</th>\
                        <td class="visible-with-data" id="wikipedia">' + (feature.properties['wikipedia'] !== null ? autolinker.link(feature.properties['wikipedia'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['surf_ha'] !== null ? autolinker.link(feature.properties['surf_ha'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
            var popup = layer.getPopup();
            var content = popup.getContent();
            var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
            popup.setContent(updatedContent);
        }

        function style_Prefecture_3_0() {
            return {
                fill: false,
                stroke: false,
                interactive: false
            }
        }
        map.createPane('pane_Prefecture_3');
        map.getPane('pane_Prefecture_3').style.zIndex = 403;
        map.getPane('pane_Prefecture_3').style['mix-blend-mode'] = 'normal';
        var layer_Prefecture_3 = new L.geoJson(json_Prefecture_3, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Prefecture_3',
            layerName: 'layer_Prefecture_3',
            pane: 'pane_Prefecture_3',
            onEachFeature: pop_Prefecture_3,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_Prefecture_3_0(feature));
            },
        });
        bounds_group.addLayer(layer_Prefecture_3);
        map.addLayer(layer_Prefecture_3);
        function pop_IndicedepositionsocialeIndedloignementdeslyces_4(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Nom du lycée</th>\
                        <td class="visible-with-data" id="appell_off">' + (feature.properties['appell_off'] !== null ? autolinker.link(feature.properties['appell_off'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">ACCES</th>\
                        <td class="visible-with-data" id="ACCES">' + (feature.properties['ACCES'] !== null ? autolinker.link(feature.properties['ACCES'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">CODA</th>\
                        <td class="visible-with-data" id="CODA">' + (feature.properties['CODA'] !== null ? autolinker.link(feature.properties['CODA'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Cordees</th>\
                        <td class="visible-with-data" id="Cordees">' + (feature.properties['Cordees'] !== null ? autolinker.link(feature.properties['Cordees'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PassEnSup</th>\
                        <td class="visible-with-data" id="PassEnSup">' + (feature.properties['PassEnSup'] !== null ? autolinker.link(feature.properties['PassEnSup'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Cord_JPPJV</th>\
                        <td class="visible-with-data" id="Cord_JPPJV">' + (feature.properties['Cord_JPPJV'] !== null ? autolinker.link(feature.properties['Cord_JPPJV'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nombre de dispositifs</th>\
                        <td class="visible-with-data" id="Total Disp">' + (feature.properties['Total Disp'] !== null ? autolinker.link(feature.properties['Total Disp'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Indice de position sociale</th>\
                        <td class="visible-with-data" id="IPS">' + (feature.properties['IPS'] !== null ? autolinker.link(feature.properties['IPS'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Indicateur d\'éloignement à l\'ESR</th>\
                        <td class="visible-with-data" id="IEL">' + (feature.properties['IEL'] !== null ? autolinker.link(feature.properties['IEL'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Indicateur</th>\
                        <td class="visible-with-data" id="Indicateur">' + (feature.properties['Indicateur'] !== null ? autolinker.link(feature.properties['Indicateur'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
            var popup = layer.getPopup();
            var content = popup.getContent();
            var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
            popup.setContent(updatedContent);
        }

        function style_IndicedepositionsocialeIndedloignementdeslyces_4_0(feature) {
            switch(String(feature.properties['Indicateur'])) {
                case 'Defavorise eloigne':
                    return {
                pane: 'pane_IndicedepositionsocialeIndedloignementdeslyces_4',
                radius: 12.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(97,31,83,0.47058823529411764)',
                interactive: true,
            }
                    break;
                case 'Defavorise proche':
                    return {
                pane: 'pane_IndicedepositionsocialeIndedloignementdeslyces_4',
                radius: 12.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(203,27,79,0.5490196078431373)',
                interactive: true,
            }
                    break;
                case 'Favorise eloigne':
                    return {
                pane: 'pane_IndicedepositionsocialeIndedloignementdeslyces_4',
                radius: 12.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(245,136,96,0.5254901960784314)',
                interactive: true,
            }
                    break;
                case 'Favorise proche':
                    return {
                pane: 'pane_IndicedepositionsocialeIndedloignementdeslyces_4',
                radius: 12.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,245,240,0.8392156862745098)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_IndicedepositionsocialeIndedloignementdeslyces_4');
        map.getPane('pane_IndicedepositionsocialeIndedloignementdeslyces_4').style.zIndex = 404;
        map.getPane('pane_IndicedepositionsocialeIndedloignementdeslyces_4').style['mix-blend-mode'] = 'normal';
        var layer_IndicedepositionsocialeIndedloignementdeslyces_4 = new L.geoJson(json_IndicedepositionsocialeIndedloignementdeslyces_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_IndicedepositionsocialeIndedloignementdeslyces_4',
            layerName: 'layer_IndicedepositionsocialeIndedloignementdeslyces_4',
            pane: 'pane_IndicedepositionsocialeIndedloignementdeslyces_4',
            onEachFeature: pop_IndicedepositionsocialeIndedloignementdeslyces_4,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_IndicedepositionsocialeIndedloignementdeslyces_4_0(feature));
            },
        });
        bounds_group.addLayer(layer_IndicedepositionsocialeIndedloignementdeslyces_4);
        map.addLayer(layer_IndicedepositionsocialeIndedloignementdeslyces_4);
            var title = new L.Control();
            title.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info');
                this.update();
                return this._div;
            };
            title.update = function () {
                this._div.innerHTML = '<h2>IPS, indice d\'éloignement à l\'ESR et dispositifs égalité des chances des lycées</h2>';
            };
            title.addTo(map);
            var abstract = new L.Control({'position':'bottomleft'});
            abstract.onAdd = function (map) {
                this._div = L.DomUtil.create('div',
                'leaflet-control abstract');
                this._div.id = 'abstract'
                    this._div.setAttribute("onmouseenter", "abstract.show()");
                    this._div.setAttribute("onmouseleave", "abstract.hide()");
                    this.hide();
                    return this._div;
                };
                abstract.hide = function () {
                    this._div.classList.remove("abstractUncollapsed");
                    this._div.classList.add("abstract");
                    this._div.innerHTML = 'i'
                }
                abstract.show = function () {
                    this._div.classList.remove("abstract");
                    this._div.classList.add("abstractUncollapsed");
                    this._div.innerHTML = 'Cette carte représente les indicateurs d\'IPS et d\'éloignement à l\'ESR des  lycées de la Région Nouvelle Aquitaine selon le nombre de dispositifs d\'égalité des chances portés par les établissements de l\'ESR signataires de la Convention de coordination territoriale.<br /><br />Données : <br /><br /> - IPS = l\'Indice de position sociale résume le capital social, économique et culturel de la famille dans le rapport de l\'élève à l\'école. La valeur de l\'IPS est d\'autant plus élevée que la PCS est considérée comme favorable à la réussite scolaire de l\'élève. Cette indice varie de 69 à 145. <br /><br />- Indice d\'éloignement à l\'ESR = Cet indice permet de synthétiser en un indicateur la notion d\'éloignement pour un établissement donnée. Il permet de prendre en compte les différents aspects de la ruralité et de l\'éloignement des établissements ainsi que de classer tous les établissements de manière continue, du moins "éloigné" au plus "éloigné" et de fournir ainsi une approche relative. <br /><br />- Dispositifs d\'égalité des chances portés par les établissements de la CCT, recensés au 30 janvier 2023, comprenant : les cordées de la réussite (JPPJV et hors JPPJV), les grands projets PIA (ACCES et CODA) ainsi que le dispositif Pass\'en Sup.<br /><br />Champs : <br /><br />Les indices par établissement sont calculés pour les lycées de France métropolitaine et DROM, publics et privés sous contrat, à partir des données de la rentrée N et pour les élèves du second cycle uniquement. Les indices de chaque établissement sont déclinés pour les élèves de la voie générale et technologique uniquement, pour les élèves de la voie professionnelle uniquement, et pour l’ensemble des élèves du second cycle.<br /><br /><br />Description de l\'indicateur composite :<br /><br />Un lycée est défavorisé (respectivement favorisé) lorsque son IPS est inférieur (supérieur) à la médiane de l\'IPS des lycées de la région ;<br />Un lycée est éloigné (respectivement proche) lorsque son indice d\'éloignement est supérieur (inférieur) à la médiane de l\'indice d\'éloignement des lycées de la région. <br /><br />Sources :  <br /><br />Mission d\'appui à l\'orientation et l\'insertion professionnelle (MAOIP), Université de Bordeaux<br />Direction de l\'évaluation, de la prospective et de la performance (DEPP), Minstère de l\'éducation nationale (MEN)<br /><br />Cartographie : <br /><br />Service de coordination des études et enquêtes (CT2E), Université de Bordeaux';
            };
            abstract.addTo(map);
        var baseMaps = {};
        L.control.layers(baseMaps,{'Indice de position sociale - Inde d\'éloignement des lycées<br /><table><tr><td style="text-align: center;"><img src="legend/IndicedepositionsocialeIndedloignementdeslyces_4_Defavoriseeloigne0.png" /></td><td>Defavorise eloigne</td></tr><tr><td style="text-align: center;"><img src="legend/IndicedepositionsocialeIndedloignementdeslyces_4_Defavoriseproche1.png" /></td><td>Defavorise proche</td></tr><tr><td style="text-align: center;"><img src="legend/IndicedepositionsocialeIndedloignementdeslyces_4_Favoriseeloigne2.png" /></td><td>Favorise eloigne</td></tr><tr><td style="text-align: center;"><img src="legend/IndicedepositionsocialeIndedloignementdeslyces_4_Favoriseproche3.png" /></td><td>Favorise proche</td></tr></table>': layer_IndicedepositionsocialeIndedloignementdeslyces_4,'Prefecture': layer_Prefecture_3,'<img src="legend/Rgion_2.png" /> Région': layer_Rgion_2,'<img src="legend/Dpartement_1.png" /> Département': layer_Dpartement_1,"OSM Standard": layer_OSMStandard_0,},{collapsed:false}).addTo(map);
        setBounds();
        var i = 0;
        layer_Prefecture_3.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['nom'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Liberation Sans\', sans-serif;">' + layer.feature.properties['nom']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Prefecture_3'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        map.addControl(new L.Control.Search({
            layer: layer_IndicedepositionsocialeIndedloignementdeslyces_4,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'appell_off'}));
        document.getElementsByClassName('search-button')[0].className +=
         ' fa fa-binoculars';
        var mapDiv = document.getElementById('map');
        var row = document.createElement('div');
        row.className="row";
        row.id="all";
        row.style.height = "100%";
        var col1 = document.createElement('div');
        col1.className="col9";
        col1.id = "mapWindow";
        col1.style.height = "99%";
        col1.style.width = "80%";
        col1.style.display = "inline-block";
        var col2 = document.createElement('div');
        col2.className="col3";
        col2.id = "menu";
        col2.style.display = "inline-block";
        mapDiv.parentNode.insertBefore(row, mapDiv);
        document.getElementById("all").appendChild(col1);
        document.getElementById("all").appendChild(col2);
        col1.appendChild(mapDiv)
        var Filters = {"Total Disp": "int","IPS": "real","IEL": "real","Indicateur": "str"};
        function filterFunc() {
          map.eachLayer(function(lyr){
          if ("options" in lyr && "dataVar" in lyr["options"]){
            features = this[lyr["options"]["dataVar"]].features.slice(0);
            try{
              for (key in Filters){
                keyS = key.replace(/[^a-zA-Z0-9_]/g, "")
                if (Filters[key] == "str" || Filters[key] == "bool"){
                  var selection = [];
                  var options = document.getElementById("sel_" + keyS).options
                  for (var i=0; i < options.length; i++) {
                    if (options[i].selected) selection.push(options[i].value);
                  }
                    try{
                      if (key in features[0].properties){
                        for (i = features.length - 1;
                          i >= 0; --i){
                          if (selection.indexOf(
                          features[i].properties[key])<0
                          && selection.length>0) {
                          features.splice(i,1);
                          }
                        }
                      }
                    } catch(err){
                  }
                }
                if (Filters[key] == "int"){
                  sliderVals =  document.getElementById(
                    "div_" + keyS).noUiSlider.get();
                  try{
                    if (key in features[0].properties){
                    for (i = features.length - 1; i >= 0; --i){
                      if (parseInt(features[i].properties[key])
                          < sliderVals[0]
                          || parseInt(features[i].properties[key])
                          > sliderVals[1]){
                            features.splice(i,1);
                          }
                        }
                      }
                    } catch(err){
                    }
                  }
                if (Filters[key] == "real"){
                  sliderVals =  document.getElementById(
                    "div_" + keyS).noUiSlider.get();
                  try{
                    if (key in features[0].properties){
                    for (i = features.length - 1; i >= 0; --i){
                      if (features[i].properties[key]
                          < sliderVals[0]
                          || features[i].properties[key]
                          > sliderVals[1]){
                            features.splice(i,1);
                          }
                        }
                      }
                    } catch(err){
                    }
                  }
                if (Filters[key] == "date"
                  || Filters[key] == "datetime"
                  || Filters[key] == "time"){
                  try{
                    if (key in features[0].properties){
                      HTMLkey = key.replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g, '');
                      startdate = document.getElementById("dat_" +
                        HTMLkey + "_date1").value.replace(" ", "T");
                      enddate = document.getElementById("dat_" +
                        HTMLkey + "_date2").value.replace(" ", "T");
                      for (i = features.length - 1; i >= 0; --i){
                        if (features[i].properties[key] < startdate
                          || features[i].properties[key] > enddate){
                          features.splice(i,1);
                        }
                      }
                    }
                  } catch(err){
                  }
                }
              }
            } catch(err){
            }
          this[lyr["options"]["layerName"]].clearLayers();
          this[lyr["options"]["layerName"]].addData(features);
        var i = 0;
        layer_Prefecture_3.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['nom'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Liberation Sans\', sans-serif;">' + layer.feature.properties['nom']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Prefecture_3'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
          }
          })
        }
            document.getElementById("menu").appendChild(
                document.createElement("div"));
            var div_TotalDisp = document.createElement("div");
            div_TotalDisp.id = "div_TotalDisp";
            div_TotalDisp.className = "slider";
            document.getElementById("menu").appendChild(div_TotalDisp);
            var lab_TotalDisp = document.createElement('div');
            lab_TotalDisp.innerHTML  = 'Total Disp: <span id="val_TotalDisp"></span>';
            lab_TotalDisp.className = 'filterlabel';
            document.getElementById("menu").appendChild(lab_TotalDisp);
            var reset_TotalDisp = document.createElement('div');
            reset_TotalDisp.innerHTML = 'clear filter';
            reset_TotalDisp.className = 'filterlabel';
            lab_TotalDisp.className = 'filterlabel';
            reset_TotalDisp.onclick = function() {
                sel_TotalDisp.noUiSlider.reset();
            };
            document.getElementById("menu").appendChild(reset_TotalDisp);
            var sel_TotalDisp = document.getElementById('div_TotalDisp');
            noUiSlider.create(sel_TotalDisp, {
                connect: true,
                start: [0, 4],
                step: 1,
                format: wNumb({
                    decimals: 0,
                    }),
                range: {
                min: 0,
                max: 4
                }
            });
            sel_TotalDisp.noUiSlider.on('update', function (values) {
            filterVals =[];
            for (value in values){
            filterVals.push(parseInt(value))
            }
            val_TotalDisp = document.getElementById('val_TotalDisp');
            val_TotalDisp.innerHTML = values.join(' - ');
                filterFunc()
            });
            document.getElementById("menu").appendChild(
                document.createElement("div"));
            var div_IPS = document.createElement("div");
            div_IPS.id = "div_IPS";
            div_IPS.className = "slider";
            document.getElementById("menu").appendChild(div_IPS);
            var lab_IPS = document.createElement('div');
            lab_IPS.innerHTML  = 'IPS: <span id="val_IPS"></span>';
            lab_IPS.className = 'filterlabel';
            document.getElementById("menu").appendChild(lab_IPS);
            var reset_IPS = document.createElement('div');
            reset_IPS.innerHTML = 'clear filter';
            reset_IPS.className = 'filterlabel';
            lab_IPS.className = 'filterlabel';
            reset_IPS.onclick = function() {
                sel_IPS.noUiSlider.reset();
            };
            document.getElementById("menu").appendChild(reset_IPS);
            var sel_IPS = document.getElementById('div_IPS');
            noUiSlider.create(sel_IPS, {
                connect: true,
                start: [68.7, 144.7],
                range: {
                min: 68.7,
                max: 144.7
                }
            });
            sel_IPS.noUiSlider.on('update', function (values) {
            val_IPS = document.getElementById('val_IPS');
            val_IPS.innerHTML = values.join(' - ');
                filterFunc()
            });
            document.getElementById("menu").appendChild(
                document.createElement("div"));
            var div_IEL = document.createElement("div");
            div_IEL.id = "div_IEL";
            div_IEL.className = "slider";
            document.getElementById("menu").appendChild(div_IEL);
            var lab_IEL = document.createElement('div');
            lab_IEL.innerHTML  = 'IEL: <span id="val_IEL"></span>';
            lab_IEL.className = 'filterlabel';
            document.getElementById("menu").appendChild(lab_IEL);
            var reset_IEL = document.createElement('div');
            reset_IEL.innerHTML = 'clear filter';
            reset_IEL.className = 'filterlabel';
            lab_IEL.className = 'filterlabel';
            reset_IEL.onclick = function() {
                sel_IEL.noUiSlider.reset();
            };
            document.getElementById("menu").appendChild(reset_IEL);
            var sel_IEL = document.getElementById('div_IEL');
            noUiSlider.create(sel_IEL, {
                connect: true,
                start: [93.7, 139.7],
                range: {
                min: 93.7,
                max: 139.7
                }
            });
            sel_IEL.noUiSlider.on('update', function (values) {
            val_IEL = document.getElementById('val_IEL');
            val_IEL.innerHTML = values.join(' - ');
                filterFunc()
            });
            document.getElementById("menu").appendChild(
                document.createElement("div"));
            var div_Indicateur = document.createElement('div');
            div_Indicateur.id = "div_Indicateur";
            div_Indicateur.className= "filterselect";
            document.getElementById("menu").appendChild(div_Indicateur);
            sel_Indicateur = document.createElement('select');
            sel_Indicateur.multiple = true;
            sel_Indicateur.size = 4;
            sel_Indicateur.id = "sel_Indicateur";
            var Indicateur_options_str = "<option value='' unselected></option>";
            sel_Indicateur.onchange = function(){filterFunc()};
            Indicateur_options_str  += '<option value="Defavorise eloigne">Defavorise eloigne</option>';
            Indicateur_options_str  += '<option value="Defavorise proche">Defavorise proche</option>';
            Indicateur_options_str  += '<option value="Favorise eloigne">Favorise eloigne</option>';
            Indicateur_options_str  += '<option value="Favorise proche">Favorise proche</option>';
            sel_Indicateur.innerHTML = Indicateur_options_str;
            div_Indicateur.appendChild(sel_Indicateur);
            var lab_Indicateur = document.createElement('div');
            lab_Indicateur.innerHTML = 'Indicateur';
            lab_Indicateur.className = 'filterlabel';
            div_Indicateur.appendChild(lab_Indicateur);
            var reset_Indicateur = document.createElement('div');
            reset_Indicateur.innerHTML = 'clear filter';
            reset_Indicateur.className = 'filterlabel';
            reset_Indicateur.onclick = function() {
                var options = document.getElementById("sel_Indicateur").options;
                for (var i=0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_Indicateur.appendChild(reset_Indicateur);
        resetLabels([layer_Prefecture_3]);
        map.on("zoomend", function(){
            resetLabels([layer_Prefecture_3]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_Prefecture_3]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_Prefecture_3]);
        });
        </script>
    </body>
</html>
